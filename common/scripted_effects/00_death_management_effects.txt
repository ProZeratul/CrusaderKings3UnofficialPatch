add_death_event_blocker_effect = {
	set_variable = {
		name = block_death_event_from
		value = $DEAD$
		days = 3
	}
	#If we get timed variables in list:
#	add_to_variable_list = {
#		name = block_death_event_from
#		target = $DEAD$
#		days = 3
#	}
}

silent_disappearance_effect = {
	hidden_effect = {
		if = {
			limit = {
				is_alive = yes
				is_ruler = no
				trigger_if = {
					limit = {
						is_married = no
						is_concubine = no
					}
					NOT = { any_player = { is_close_or_extended_family_of = prev } }
				}
				trigger_else = {
					save_temporary_scope_as = stk_prune_char
					any_player = {
						NOR = {
							is_close_or_extended_family_of = scope:stk_prune_char
							any_consort = { this = scope:stk_prune_char }
							any_close_family_member = { is_spouse_of = scope:stk_prune_char }
						}
					}
				}
			}

			death = {
		 		death_reason = death_disappearance
		 	}
		}
	}
}

silent_disappearance_ai_effect = {
	hidden_effect = {
		if = {
			limit = {
				is_alive = yes
				root = { is_ai = yes }
				is_ruler = no
				trigger_if = {
					limit = {
						is_married = no
						is_concubine = no
					}
					NOT = { any_player = { is_close_or_extended_family_of = prev } }
				}
				trigger_else = {
					save_temporary_scope_as = stk_prune_char
					any_player = {
						NOR = {
							is_close_or_extended_family_of = scope:stk_prune_char
							any_consort = { this = scope:stk_prune_char }
							any_close_family_member = { is_spouse_of = scope:stk_prune_char }
						}
					}
				}
			}

			death = {
		 		death_reason = death_disappearance
		 	}
		}
	}
}

silent_disappearance_ai_if_created_effect = {
	hidden_effect = {
		if = {
			limit = {
				is_alive = yes
				root = { is_ai = yes }
				has_character_flag = created
			}

			death = {
		 		death_reason = death_disappearance
		 	}
		}
	}
}

silent_disappear_ai_if_not_hired = {
	hidden_effect = {
		if = {
			limit = {
				is_alive = yes
				root = { is_ai = yes }
				employer != root
				trigger_if = {
					limit = {
						is_married = no
						is_concubine = no
					}
					NOT = { any_player = { is_close_or_extended_family_of = prev } }
				}
				trigger_else = {
					save_temporary_scope_as = stk_prune_char
					any_player = {
						NOR = {
							is_close_or_extended_family_of = scope:stk_prune_char
							any_consort = { this = scope:stk_prune_char }
							any_close_family_member = { is_spouse_of = scope:stk_prune_char }
						}
					}
				}
			}

			death = {
		 		death_reason = death_disappearance
		 	}
		}
		else_if = {
			limit = {
				is_alive = yes
				employer != root
			}
			move_to_pool = yes
		}
	}
}

silent_disappear_ai_if_not_hired_with_flag = {
	hidden_effect = {
		if = {
			limit = {
				is_alive = yes
				root = { is_ai = yes }
				employer != root
				has_character_flag = created
			}

			death = {
		 		death_reason = death_disappearance
		 	}
		}
		else_if = {
			limit = {
				is_alive = yes
				employer != root
				has_character_flag = created
			}
			move_to_pool = yes
		}
	}
}

save_died_in_battle_variables_effect = {
	set_variable = {
		name = battle_death_enemy
		value = $ENEMY$
	}
	set_variable = {
		name = battle_death_leader
		value = $LEADER$
	}
	set_variable = {
		name = battle_death_location
		value = $LOCATION$
	}
}
